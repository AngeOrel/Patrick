<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WebSIG - Gestion Fonci√®re</title>
    
    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    
    <!-- CSS personnalis√© -->
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <div id="container">
        <!-- Barre lat√©rale -->
        <div id="sidebar">
            <h1>üó∫Ô∏è WebSIG Foncier</h1>
            
            <div class="panel">
                <h3>üîç Recherche</h3>
                <select id="searchLayer">
                    <option value="lots">Lots</option>
                    <option value="ilots">√élots</option>
                    <option value="polygonale">Polygonale</option>
                </select>
                <input type="text" id="searchInput" placeholder="Rechercher...">
                <button onclick="performSearch()">Rechercher</button>
            </div>
            
            <div class="panel">
                <h3>üé® Filtres</h3>
                <select id="filterLayer">
                    <option value="lots">Lots</option>
                    <option value="ilots">√élots</option>
                </select>
                <select id="filterAttribute">
                    <option value="">-- Attribut --</option>
                    <option value="proprietaire">Propri√©taire</option>
                    <option value="type">Type</option>
                </select>
                <input type="text" id="filterValue" placeholder="Valeur">
                <button onclick="applyFilter()">Appliquer</button>
                <button onclick="clearFilter()">R√©initialiser</button>
            </div>
            
            <div class="panel">
                <h3>üì• Export</h3>
                <button onclick="exportData('lots')">Exporter Lots</button>
                <button onclick="exportData('ilots')">Exporter √élots</button>
            </div>
            
            <div class="panel info">
                <p><small>Derni√®re mise √† jour: <span id="lastUpdate">-</span></small></p>
            </div>
        </div>
        
        <!-- Carte -->
        <div id="map"></div>
    </div>
    
    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    
    <!-- Scripts personnalis√©s -->
    <script src="js/config.js"></script>
    <script src="js/map.js"></script>
    
    <!-- Fonctions d'interface -->
    <script>
        function performSearch() {
            const layer = document.getElementById('searchLayer').value;
            const term = document.getElementById('searchInput').value;
            const attribute = CONFIG.dataLayers[layer].attribution;
            searchFeature(layer, attribute, term);
        }
        
        function applyFilter() {
            const layer = document.getElementById('filterLayer').value;
            const attribute = document.getElementById('filterAttribute').value;
            const value = document.getElementById('filterValue').value;
            if (attribute) {
                filterLayer(layer, attribute, value);
            }
        }
        
        function clearFilter() {
            document.getElementById('filterValue').value = '';
            for (const layerId of Object.keys(loadedLayers)) {
                loadedLayers[layerId].eachLayer(sublayer => {
                    sublayer.setStyle(CONFIG.dataLayers[layerId].style);
                });
            }
        }
        
        function exportData(layerId) {
            exportVisibleData(layerId);
        }
        
        // Afficher la date de derni√®re mise √† jour
        fetch('./data/processed/lots.geojson?v=' + Date.now())
            .then(response => response.headers.get('last-modified'))
            .then(date => {
                if (date) {
                    document.getElementById('lastUpdate').textContent = 
                        new Date(date).toLocaleDateString('fr-FR');
                }
            });
    </script>
</body>
</html>